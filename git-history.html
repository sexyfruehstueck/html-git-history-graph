<!doctype>
<html>
    <head>
        <title>GIT HISTORY</title>
        <style contenteditable="true" style="display:block;">
            #canvas{
                width: 800px;
                height: 400px;
            }
        </style>
        <script>

            let ctx;

            window.addEventListener("load", e => {
                ctx = document.querySelector("#canvas").getContext("2d");
                initialize();
                _drawBackground();
                _drawStaticImage();
            });

            function _drawStaticImage(){

                _initRepo();


                _startFeature();

                    _newCommit();
                    
                    _newCommit();

                _endFeature();

                _startRelease();

                    _newCommit();
                
                _endRelease();

                _goToTimeSlot(2);
                
                _startHotfix();
                
                _endHotfix();

            }

            let lines = {
                master:  20,
                hotfix:  100,
                release: 180,
                develop: 260,
                feature: 340
            };  

            let colors = {
                master: "#9C2BFF",
                hotfix: "#FF0A26",
                release:"#cdcdcd",
                develop:"#68C5FF",
                feature:"#FF701E"               
            };

            let repoStatus = {
                currentPosition: 80,
                path: new Path2D()
            };

            function _goToTimeSlot(slot){
                repoStatus.currentPosition = slot * 80;
            }

            function _startHotfix(){
                repoStatus.currentBranch = "hotfix";
                __nextTimeSlot();
                _setColor();
                _drawPoint(repoStatus.currentPosition, lines.hotfix, 10);
                _drawConnection(
                    repoStatus.currentPosition - 80, lines.master,
                    repoStatus.currentPosition, lines.hotfix
                );
                //repoStatus.startPoints.push({x: repoStatus.currentPosition, y: lines.hotfix});
            }

            function _endHotfix(){
                __nextTimeSlot();
                _setMasterPoint();
                _drawConnection(
                    repoStatus.currentPosition - 80, lines.hotfix,
                    repoStatus.currentPosition, lines.master
                );    

                _setDevelopPoint();
                _drawConnection(
                    repoStatus.currentPosition - 80, lines.hotfix,
                    repoStatus.currentPosition, lines.develop
                );        
            }

            function _endRelease(){
                __nextTimeSlot();
                _setMasterPoint();
                _drawConnection(
                    repoStatus.currentPosition - 80, lines.release,
                    repoStatus.currentPosition, lines.master
                );

                _drawConnection(
                    repoStatus.currentPosition - 80, lines.release,
                    repoStatus.currentPosition, lines.develop
                );

                _setDevelopPoint();
            }

            function _setMasterPoint(){
                repoStatus.currentBranch = "master";
                _setColor();
                _drawPoint(repoStatus.currentPosition, lines.master, 10);

                if(repoStatus.lastMaster){
                    ctx.strokeStyle = "#000000";
                    ctx.lineWidth = 4;
                    _drawLine(repoStatus.lastMaster.x, lines.master, repoStatus.currentPosition, lines.master);
                }
                repoStatus.lastMaster = {x: repoStatus.currentPosition, y:lines.master};
            }

            function _setDevelopPoint(){
                repoStatus.currentBranch = "develop";
                _setColor();
                _drawPoint(repoStatus.currentPosition, lines.develop, 10);

                if(repoStatus.lastDevelop){
                    ctx.strokeStyle = "#000000";
                    ctx.lineWidth = 4;
                    _drawLine(repoStatus.lastDevelop.x, lines.develop, repoStatus.currentPosition, lines.develop);
                }
                repoStatus.lastDevelop = {x: repoStatus.currentPosition, y:lines.develop};
            }

            function _startRelease(){
                repoStatus.currentBranch = "release";
                __nextTimeSlot();
                _setColor();
                _drawPoint(repoStatus.currentPosition, lines.release, 10);
                _drawConnection(
                    repoStatus.currentPosition - 80, lines.develop,
                    repoStatus.currentPosition, lines.release
                );
            }

            function _endFeature(){   
                __nextTimeSlot();
                _setDevelopPoint();
                _drawConnection(
                    repoStatus.currentPosition - 80, lines.feature,
                    repoStatus.currentPosition, lines.develop
                );
            }

            function __nextTimeSlot(draw){
                repoStatus.currentPosition += 80;
                if(draw){
                    ctx.strokeStyle = "#000000";
                    ctx.lineWidth = 4;
                    _drawLine(repoStatus.currentPosition, lines[repoStatus.currentBranch], 
                    repoStatus.currentPosition - 80, lines[repoStatus.currentBranch]);
                } 
            }

            function _setColor(){
                ctx.strokeStyle = colors[repoStatus.currentBranch];
            }

            function _startFeature(){
                repoStatus.currentBranch = "feature";
                __nextTimeSlot();
                _setColor();
                _drawPoint(repoStatus.currentPosition, lines.feature, 10);
                _drawConnection(
                    repoStatus.currentPosition - 80, lines.develop,
                    repoStatus.currentPosition, lines.feature
                );
            }

            function _newCommit(){
                __nextTimeSlot(true);
                _setColor();
                _drawPoint(repoStatus.currentPosition, lines[repoStatus.currentBranch], 10);
            }

            function _initRepo(){
                _setMasterPoint();
                _newCommit();
                _setMasterPoint();
                _drawConnection(
                    repoStatus.currentPosition, lines.master,
                    repoStatus.currentPosition, lines.develop
                );
                _setDevelopPoint();
            }

            function initialize(){
                ctx.canvas.width = 800;
                ctx.canvas.height = 400;
            }

            function _drawLine(fromx, fromy, tox, toy){
                let line = new Path2D();
                line.moveTo(fromx, fromy + .5);
                line.lineTo(tox, toy + .5);
                ctx.stroke(line);
            }

            function _drawPoint(x, y, size, style){
                
                ctx.fillStyle = "#ffffff";
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.closePath();
                ctx.fill()

                ctx.lineWidth = 10;
                ctx.setLineDash([]);
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.closePath();
                ctx.stroke();
            }

            function _drawConnection(fromx, fromy, tox, toy){
                let dist = (tox - fromx);
                ctx.strokeStyle = "#000000";
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(fromx, fromy);
                ctx.bezierCurveTo(fromx + dist, fromy, tox - dist, toy, tox, toy);
                ctx.stroke();

              /*  ctx.fillStyle = "red";
                ctx.fillRect(fromx + dist, fromy, 10, 10);
                ctx.fillRect(tox - dist, toy, 10, 10);*/
            }

            function _drawBackground(){
                ctx.strokeStyle = "#a1a1a1";
                ctx.lineWidth = 2;
                ctx.setLineDash([2, 5]);

                _drawLine(20, lines.master, 780, lines.master);
                _drawLine(20, lines.feature, 780, lines.feature);

                ctx.strokeStyle = "#a1a1a1";
                ctx.lineWidth = 1;
                ctx.setLineDash([1, 5]);
                _drawLine(20, lines.hotfix, 780, lines.hotfix);
                _drawLine(20, lines.release, 780, lines.release);
                _drawLine(20, lines.develop	, 780, lines.develop);

            }
        </script>
    </head>
    <body>
        <canvas id="canvas">

        </canvas>
    </body>
</html>